typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var minimajs={};minimajs.drivers={},minimajs.config={},minimajs.BaseApp=function(){this.AppClass=minimajs.BaseModule,this.load=function(e){return this.AppClass.modules[e]===undefined?(minimajs.debug("Error: Could not find module "+e),!1):this.module instanceof this.AppClass.modules[e]?(minimajs.debug("Warning: The module "+e+" is already loaded. Will not reload."),!1):(this.module!==undefined&&this.unload(),this.module=this.factory(this.AppClass.modules[e],e),this.module)},this.unload=function(){this.module!==""&&this.module instanceof minimajs.BaseModule&&(minimajs.debug("Unloading current module: "+this.module.identifier),this.module.destroy(),this.module=undefined)},this.getModule=function(){return this.module},this.factory=function(e,t){if(typeof e!="function"){minimajs.debug("Will not instantiate the class since it's actually not a class.",t);return}var n=new e;return minimajs.inherit(n),n instanceof minimajs.BaseModule?n.identifier=t:n instanceof minimajs.BaseDriver?this.driver=n:n instanceof minimajs.BaseRouter&&(this.router=n),n.app=this,typeof n.init=="function"&&n.init(),n}},minimajs.factory=function(e){if(e.isExtending(minimajs.BaseApp)===!0){var t=new e;return minimajs.inherit(t),t.AppClass=e,t.message=new minimajs.Message,t.bindings=new minimajs.Bindings,t.factory(minimajs.config.driver),t.init(),t}return minimajs.debug("Error: I can only produce applications, the specified class is not an application."),!1},minimajs.clone=function(e){if(typeof e=="object"){var t={};for(var n in e)typeof e[n]=="object"?t[n]=minimajs.clone(e[n]):t[n]=e[n];return t}return e},minimajs.debug=function(e){if(minimajs.config.debug===!1)return;try{console.log(e)}catch(t){}},Function.prototype.extend=function(e){if(typeof e!="function")return minimajs.debug("Baseclass unknown, will not inherit from ",e),this;var t=new this;return this.prototype=new e,this.prototype.constructor=this,this.prototype.Base=e,this.prototype.childInstance=t,this.isExtending(minimajs.BaseApp)&&(this.modules={}),this},Function.prototype.isExtending=function(e){return typeof this.prototype.Base=="function"&&this.prototype.Base===e},minimajs.inherit=function(e){if(e.Base===undefined)return;var t=new e.Base;minimajs.inherit(t),e._super=t;for(var n in t)n in e.childInstance||(e[n]=t[n])},minimajs.Observe=function(){return this.observers=[],this.distribute=function(e){for(var t in this.observers)this.observers[t].action===e&&this.observers[t].callback.call(this.observers[t].scope,e,this)},this.observe=function(){var e=this,t=arguments[0],n=[].slice.call(arguments,1,arguments.length-1),r=arguments[arguments.length-1];if(typeof t=="object"&&"observers"in t)for(var i in n)t.observers.push({action:n[i],callback:r,scope:this});else minimajs.debug("Warning: The following object is not observable:",t);return this},this.unobserve=function(){var e=arguments[0],t=[].slice.call(arguments,1,arguments.length);if(typeof e=="object"&&"observers"in e){for(var n in t)for(var r in e.observers)if(e.observers[r].action===t[n]){e.observers.splice(r,1);break}}else minimajs.debug("Warning: It is not possible to stop observing the given object since it's not observable.",e)},this},minimajs.BaseRouter=function(){var e=function(e){e in this.routes?this.app.load(this.routes[e]):minimajs.debug("Error: Could not find route for "+e)},t=function(){var e=document.location.hash;return e.substring(0,1)==="#"&&(e=e.substring(1)),e.substring(0,1)===this.prefix&&(e=e.substring(1)),e.length===0&&(e="/"),e};this.routes={},this.prefix="!",this.start=function(n){var r;n!==undefined?r=n:r=t.call(this),e.call(this,r)},window.onhashchange=function(){var n=t.call(self.app.router);e.call(app.router,n)}},minimajs.BaseModule=function(){var e=[],t=[];this.identifier="",this.factory=function(n){if(n in this.app.AppClass.modules[this.identifier]){var r=this.app.AppClass.modules[this.identifier][n];if(!(r.isExtending(minimajs.BaseCollection)||r.isExtending(minimajs.BaseModel)||r.isExtending(minimajs.BasePresentation)))return minimajs.debug("Warning: Will not create an instance of "+n+". I can only produce presentations, collections and models."),!1;var i=new this.app.AppClass.modules[this.identifier][n];return minimajs.inherit(i),i.module=this,i.app=this.app,typeof i.init=="function"&&i.init.apply(i,[].slice.call(arguments,1)),i instanceof minimajs.BasePresentation?e.push(i):i instanceof minimajs.BaseCollection&&t.push(i),i}return minimajs.debug("Warning: Will not create an instance of "+n+" since it cannot be found in the module."),!1},this.getPresentations=function(){return e},this.destroy=function(){var n;for(n in e)e[n].destroy();for(n in t)e[n].destroy()}}.extend(minimajs.Observe),minimajs.BasePresentation=function(){var e=[],t=[];this.domType="div",this.domData={},this.dom=!1,this.applyInput=function(){var t=this;this.unbindInput();for(var n in this.input){var r=n.split(" ");if(r.length<2){minimajs.debug("Warning: skipping input '"+n+"', it seems malformed.");continue}var i=r[0],s=n.substring(r[0].length+1),o=minimajs.config.selectorEngine(s,this.dom),u=function(e,n){return function(r){typeof t.input[n]=="function"?t.input[n].call(t,e,this,r):minimajs.debug("Cannot run this, does not seem to be a function: ",t.input[n])}}(i,n);e.push({elements:o,inputType:i}),this.app.bindings.bind(o,i,u)}},this.unbindInput=function(){for(var t in e){var n=e[t];this.app.bindings.unbind(n.elements,n.inputType)}e=[]},this.factory=function(e){if(e in this.app.AppClass.modules[this.module.identifier]&&this.app.AppClass.modules[this.module.identifier][e].isExtending(minimajs.BasePresentation)){var n=new this.app.AppClass.modules[this.module.identifier][e];return minimajs.inherit(n),n.module=this.module,n.app=this.app,typeof n.init=="function"&&n.init.apply(n,[].slice.call(arguments,1)),t.push(n),n}minimajs.debug("Warning: Will not create an instance of "+e+". I can only produce presentations from this module.")},this.compile=function(){var e=this,t=this.container;typeof this.container=="string"&&(t=minimajs.config.selectorEngine(this.container));var n=this.view;typeof this.view=="string"&&(n=minimajs.config.selectorEngine(this.view));if(t.length===0){minimajs.debug("Error: Could find container element "+this.container+" where the view was to be drawn in.");return}if(n.length===0){minimajs.debug("Error: Could find view "+this.view+", make sure that it exists.");return}this.dom===!1&&(this.dom=document.createElement(this.domType));for(var r in this.domAttributes)typeof this.domAttributes[r]=="function"?this.dom.setAttribute(r,this.domAttributes[r].call(this)):this.dom.setAttribute(r,this.domAttributes[r]);var i=minimajs.config.templateEngine(n[0].innerHTML,this.domData);this.dom.innerHTML=i,e.applyInput()},this.html=function(){this.compile();var e;if(typeof this.container=="string"){e=minimajs.config.selectorEngine(this.container);if(e.length===0)return;e=e[0]}else e=this.container;while(e.hasChildNodes())e.removeChild(e.lastChild);e.appendChild(this.dom)},this.append=function(){this.compile();var e=minimajs.config.selectorEngine(this.container);e.length>0&&e[0].appendChild(this.dom)},this.getPresentations=function(){return t},this.destroy=function(){this.unbindInput();for(var e in t)t[e].destroy();t=[],this.dom instanceof HTMLElement&&this.dom.parentNode instanceof HTMLElement&&this.dom.parentNode.removeChild(this.dom),this.distribute("destroy")}}.extend(minimajs.Observe),minimajs.BaseModel=function(){return this.values={},this.serverValues={},this.identifier="i"+(new Date).getTime()+Math.floor(Math.random()*1e10),this.revision=0,this.change=1,this.defaults=function(e,t){for(var n in e){var r=e[n];typeof t=="object"&&n in t&&(r=t[n]),this.values[n]=r}this.serverValues=minimajs.clone(this.values)},this.get=function(e){return e in this.values?this.values[e]:(minimajs.debug("Warning: Could not get "+e+" from  ",this.values),!1)},this.set=function(e,t,n){if(this.tran===!0)return;if(!(e in this.values))return minimajs.debug("Warning: Not setting "+e+" in ",this.values),!1;this.values[e]=t,this.change=2,(!n||n.silent!==!0)&&this.distribute("change")},this.tran=!1,this.destroy=function(e){if(this.tran===!0)return;this.change=3,(!e||e.silent!==!0)&&this.distribute("destroy")},this}.extend(minimajs.Observe),minimajs.BaseCollection=function(){var e=[],t=[],n=function(){var n;for(n in e)e[n].destroy();for(n in t)t[n].destroy();e=[],t=[]},r=function(n){var r=this;this.observe(n,"change","destroy",function(n,i){if(n==="destroy")for(var s in e)if(e[s].identifier===i.identifier){t.push(e.splice(s,1)[0]),r.distribute("remove");break}r.distribute(n==="destroy"?"remove":n)})},i=function(n){minimajs.debug("Commit "+n.identifier+", "+n.change);var r;if(n.change===3){for(var i in t)if(t[i].identifier===n.identifier){this.unobserve(t[i],"destroy"),t.splice(i,1);return}for(var s in e)if(e[s].identifier===n.identifier){this.unobserve(e[s],"destroy"),e[s].destroy(),e[s].change=0,e.splice(s,1),this.distribute("remove");return}}else if(n.change===1)r=this.get(n.identifier),r===!1&&(r=this.insert(n.values,!0),r.identifier=n.identifier),r.tran=!1,r.revision=n.revision,r.change=0;else if(n.change===2){r=this.get(n.identifier);if(r===!1)for(var o in t)if(t[o].identifier===n.identifier){r=t[o];break}r!==!1&&(r.tran=!1,r.revision=n.revision,r.change=0,r.values=minimajs.clone(n.values),r.serverValues=n.values,r.distribute("change"))}},s=function(n){minimajs.debug("Revert "+n.identifier+", "+n.change);var r,i;if(n.change===1){for(r in e)if(e[r].identifier===n.identifier){this.unobserve(e[r],"destroy"),e[r].destroy(),e[r].change=0,this.distribute("remove"),e.splice(r,1);return}}else if(n.change===2)i=this.get(n.identifier),i!==!1&&(i.tran=!1,i.change=0,i.values=minimajs.clone(i.serverValues),i.distribute("change"));else if(n.change===3)for(r in t)if(t[r].identifier===n.identifier){i=t.splice(r,1)[0],i.tran=!1,i.change=0,i.revision=n.revision,e.push(i),this.distribute("insert");return}};this.init=function(){var e=this;this.module.app.message.listen("collection","commit",function(t){t.collectionId===e.identifier&&i.call(e,t)}),this.module.app.message.listen("collection","revert",function(t){t.collectionId===e.identifier&&s.call(e,t)})},this.fetch=function(t){var i=this;return this.module.app.message.send("api","fetch",this.identifier,function(s){n.call(i);for(var o in s.data){var u=i.module.factory(i.model,s.data[o].values);u.identifier=s.data[o].identifier,u.revision=s.data[o].revision,u.change=0,r.call(i,u),e.push(u)}typeof t=="function"&&t()}),this},this.save=function(){var n=[],r;for(r in e)if(e[r].change>0&&e[r].tran!==!0){e[r].tran=!0;var i={identifier:e[r].identifier,change:e[r].change,collectionId:this.identifier,revision:e[r].revision,values:minimajs.clone(e[r].values)};n.push(i)}for(r in t)t[r].tran!==!0&&(t[r].tran=!0,n.push({identifier:t[r].identifier,change:t[r].change,revision:t[r].revision,collectionId:this.identifier}));return n.length>0&&this.module.app.message.send("api","save",n),this},this.get=function(t){if(arguments.length===1){for(var n in e)if(e[n].identifier===t)return e[n];return!1}return e},this.insert=function(t,n){var i=t;return t instanceof this.app.AppClass.modules[this.module.identifier][this.model]==0&&(i=this.module.factory(this.model,t)),r.call(this,i),i.change=1,e.push(i),this.distribute("insert"),arguments.length===2&&n===!0?i:this},this.remove=function(t){for(var n in e)if(e[n].identifier===t){var r=e[n];r.destroy();break}return this},this.sort=function(){if(arguments.length===1&&typeof arguments[0]=="function")e.sort(arguments[0]);else{var t=arguments;e.sort(function(e,n){var r=0;while(r<t.length){if(e.get(t[r])===n.get(t[r])){r++;continue}return e.get(t[r])>n.get(t[r])?1:-1}return e.identifier.substring(1)-n.identifier.substring(1)})}return this.distribute("sort"),this},this.set=function(t,n,r){for(var i in e)e[i].set(t,n,r)},this.destroy=function(){n.call(this)}}.extend(minimajs.Observe),minimajs.Message=function(){var e={};this.send=function(t,n){if(t in e&&n in e[t])for(var r in e[t][n])typeof e[t][n][r]=="function"&&e[t][n][r].apply(undefined,[].slice.call(arguments,2))},this.listen=function(t,n,r){e[t]=e[t]||{},e[t][n]=e[t][n]||[],e[t][n].push(r)}},minimajs.BaseDriver=function(){this.init=function(){},this.start=function(){},this.ready=function(e){e()}},minimajs.drivers.LocalStorage=function(){var e="minimajs";this.app=undefined,this.deltas=[];var t=function(){return JSON.parse(localStorage.getItem(e))};this.start=function(e){e()},this.init=function(){var t=this;localStorage.getItem(e)===null&&this.clean(),this.app.message.listen("api","fetch",function(e,n){r.call(t,e,n)}),this.app.message.listen("api","save",function(e){for(var r in e)t.deltas.push(e[r]);n.call(t)})};var n=function(){var r=t(),i;if(this.deltas.length===0)return;var s=this.deltas.splice(0,1)[0];r.collections[s.collectionId]=r.collections[s.collectionId]||[];if(s.change===3){for(i in r.collections[s.collectionId])if(r.collections[s.collectionId][i].identifier===s.identifier){r.collections[s.collectionId].splice(i,1);break}}else if(s.change===1)r.collections[s.collectionId].push({identifier:s.identifier,values:s.values});else for(i in r.collections[s.collectionId])if(r.collections[s.collectionId][i].identifier===s.identifier){r.collections[s.collectionId][i].values=s.values;break}localStorage.setItem(e,JSON.stringify(r)),this.app.message.send("collection","commit",s),n.call(this)},r=function(e,n){var r=t(),i={data:[],status:200};e in r.collections?i.data=r.collections[e]:i.status=404,typeof n=="function"&&n(i)};this.clean=function(){localStorage.setItem(e,JSON.stringify({collections:{}}))}}.extend(minimajs.BaseDriver),minimajs.drivers.Websocket=function(){try{var e=window.WebSocket||window.MozWebSocket}catch(t){}var n,r=[],i=!1,s=function(e){minimajs.debug("Message: "+e.cmd+" on "+e.data.identifier);for(var t=r.length-1;t>=0;t--)i!==!1&&e.data.identifier===r[t].identifier&&(this.app.message.send("collection","revert",r[t]),r.splice(t,1));i!==!1&&e.data.identifier===i.identifier&&this.app.message.send("collection","revert",i),this.app.message.send("collection","commit",e.data)},o=function(e,t){t!==!0&&(i.revision=e.revision,this.app.message.send("collection","commit",i)),i=!1,u.call(this)},u=function(){if(r.length===0||i!==!1)return;var e=r.splice(0,1)[0];i=minimajs.clone(e),minimajs.debug("Save "+e.identifier+", "+r.toString()),e.change===3?n.send(JSON.stringify({cmd:"remove",data:{identifier:e.identifier,collectionId:e.collectionId,change:e.change,revision:e.revision}})):e.change===1?n.send(JSON.stringify({cmd:"insert",data:e})):n.send(JSON.stringify({cmd:"update",data:e}))},a=function(e,t){n.send(JSON.stringify({cmd:"get"})),l("get",function(e){t({data:e.data})})},f={},l=function(e,t){t&&(f[e]=t)},c=function(e,t){f[e]!==undefined&&f[e].call(this,t)};this.app=undefined,this.init=function(){var e=this;l("ack",o,function(t){o.call(e,t,!1)}),l("nack",function(t){o.call(e,t,!0)}),l("insert",function(t){s.call(e,t)}),l("update",function(t){s.call(e,t)}),l("remove",function(t){s.call(e,t)}),this.app.message.listen("api","fetch",function(t,n){a.call(e,t,n)}),this.app.message.listen("api","save",function(t){for(var n in t)minimajs.debug("Adding change: "+t[n].identifier),r.push(t[n]);minimajs.debug("After adding: "+r.toString()),u.call(e)})},this.start=function(e){n=new WebSocket(minimajs.config.driverUri,minimajs.config.driverProtocol),n.onopen=function(){e()},n.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(n){minimajs.debug("Warning. Could not parse answer from server. Does not seem to be JSON:"),minimajs.debug(e.data);return}c.call(self,t.cmd,t)}},this.clean=function(){}}.extend(minimajs.BaseDriver),minimajs.Bindings=function(){var e={};this.bind=function(t,n,r){for(var i=0;i<t.length;i++){var s=t[i];if(typeof s!="object"||typeof s.addEventListener!="function"||!typeof (r==="function"))return!1;e[n]=e[n]||[],e[n].push({el:s,action:r}),s.addEventListener(n,r,!1)}},this.unbind=function(t,n){e[n]=e[n]||[];for(var r=0;r<t.length;r++)for(var i in e[n])t[r].removeEventListener(n,e[n][i].action,!1),e[n].splice(i,1)}};